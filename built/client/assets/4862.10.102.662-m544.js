(self.webpackChunkmisskey=self.webpackChunkmisskey||[]).push([[4862],{32769:(a,e,s)=>{var t=s(11063),i=s(26143)(t);i.push([a.id,'.mk-messaging[data-compact][data-v-149d8a74]{font-size:.8em}.mk-messaging[data-compact]>.history>a[data-v-149d8a74]:last-child{border-bottom:none}.mk-messaging[data-compact]>.history>a:not([data-is-me]):not([data-is-read])>div[data-v-149d8a74]{background-image:none;border-left:4px solid #3aa2dc}.mk-messaging[data-compact]>.history>a>div[data-v-149d8a74]{padding:16px}.mk-messaging[data-compact]>.history>a>div>header>.mk-time[data-v-149d8a74]{font-size:1em}.mk-messaging[data-compact]>.history>a>div>.avatar[data-v-149d8a74]{height:42px;margin:0 12px 0 0;width:42px}.mk-messaging>.search[data-v-149d8a74]{box-shadow:0 0 2px rgba(0,0,0,.2);display:block;left:0;position:-webkit-sticky;position:sticky;top:0;width:100%;z-index:1}.mk-messaging>.search>.form[data-v-149d8a74]{background:rgba(0,0,0,.02)}.mk-messaging>.search>.form>label[data-v-149d8a74]{display:block;height:100%;left:8px;pointer-events:none;position:absolute;top:0;width:38px;z-index:1}.mk-messaging>.search>.form>label>i[data-v-149d8a74]{bottom:0;color:#555;display:block;left:0;line-height:48px;margin:auto;position:absolute;right:0;top:0;width:1em}.mk-messaging>.search>.form>input[data-v-149d8a74]{background:transparent;border:none;border-radius:5px;box-shadow:none;color:var(--faceText);font-size:1em;line-height:48px;margin:0;outline:none;padding:0 0 0 42px;width:100%}.mk-messaging>.search>.result[data-v-149d8a74]{background:#fff;display:block;left:0;margin:0;padding:0;top:0;width:100%;z-index:2}.mk-messaging>.search>.result>.users[data-v-149d8a74]{list-style:none;margin:0;padding:0}.mk-messaging>.search>.result>.users>li[data-v-149d8a74]{color:rgba(0,0,0,.8);cursor:pointer;display:inline-block;overflow:hidden;padding:8px 32px;text-decoration:none;transition:none;vertical-align:top;white-space:nowrap;width:100%;z-index:1}.mk-messaging>.search>.result>.users>li[data-v-149d8a74]:focus,.mk-messaging>.search>.result>.users>li[data-v-149d8a74]:hover{background:var(--primary);color:#fff}.mk-messaging>.search>.result>.users>li:focus .name[data-v-149d8a74],.mk-messaging>.search>.result>.users>li:focus .username[data-v-149d8a74],.mk-messaging>.search>.result>.users>li:hover .name[data-v-149d8a74],.mk-messaging>.search>.result>.users>li:hover .username[data-v-149d8a74]{color:#fff}.mk-messaging>.search>.result>.users>li[data-v-149d8a74]:active{background:var(--primaryDarken10);color:#fff}.mk-messaging>.search>.result>.users>li:active .name[data-v-149d8a74],.mk-messaging>.search>.result>.users>li:active .username[data-v-149d8a74]{color:#fff}.mk-messaging>.search>.result>.users>li .avatar[data-v-149d8a74]{border-radius:6px;margin:0 8px 0 0;max-height:32px;max-width:32px;min-height:32px;min-width:32px;vertical-align:middle}.mk-messaging>.search>.result>.users>li .name[data-v-149d8a74]{color:rgba(0,0,0,.8);font-weight:400;margin:0 8px 0 0}.mk-messaging>.search>.result>.users>li .username[data-v-149d8a74]{color:rgba(0,0,0,.3);font-weight:400}.mk-messaging>.history[data-v-149d8a74]{background:var(--face);color:var(--text);padding:1em}.mk-messaging>.history>a[data-v-149d8a74]{border-bottom:1px solid var(--faceDivider);display:block;text-decoration:none}.mk-messaging>.history>a *[data-v-149d8a74]{pointer-events:none;user-select:none}.mk-messaging>.history>a[data-v-149d8a74]:hover{box-shadow:inset 0 0 0 100px rgba(0,0,0,.05)}.mk-messaging>.history>a:hover .avatar[data-v-149d8a74]{filter:saturate(200%)}.mk-messaging>.history>a[data-v-149d8a74]:active{box-shadow:inset 0 0 0 100px rgba(0,0,0,.1)}.mk-messaging>.history>a[data-is-me][data-v-149d8a74],.mk-messaging>.history>a[data-is-read][data-v-149d8a74]{opacity:.8}.mk-messaging>.history>a:not([data-is-me]):not([data-is-read])>div[data-v-149d8a74]{background-image:url(/assets/unread.svg);background-position:0;background-repeat:no-repeat}.mk-messaging>.history>a[data-v-149d8a74]:after{clear:both;content:"";display:block}.mk-messaging>.history>a>div[data-v-149d8a74]{margin:0 auto;max-width:500px;padding:20px 30px}.mk-messaging>.history>a>div[data-v-149d8a74]:after{clear:both;content:"";display:block}.mk-messaging>.history>a>div>header[data-v-149d8a74]{align-items:center;display:flex;margin-bottom:2px;overflow:hidden;white-space:nowrap}.mk-messaging>.history>a>div>header>.name[data-v-149d8a74]{color:var(--noteHeaderName);font-size:1em;font-weight:700;margin:0;overflow:hidden;padding:0;text-overflow:ellipsis;transition:all .1s ease}.mk-messaging>.history>a>div>header>.username[data-v-149d8a74]{color:var(--noteHeaderAcct);margin:0 8px}.mk-messaging>.history>a>div>header>.mk-time[data-v-149d8a74]{color:var(--noteHeaderInfo);font-size:80%;margin:0 0 0 auto}.mk-messaging>.history>a>div>.avatar[data-v-149d8a74]{border-radius:8px;float:left;height:54px;margin:0 16px 0 0;transition:all .1s ease;width:54px}.mk-messaging>.history>a>div>.body>.text[data-v-149d8a74]{color:var(--faceText);display:block;font-size:1.1em;margin:0;overflow:hidden;overflow-wrap:break-word;padding:0}.mk-messaging>.history>a>div>.body>.text .me[data-v-149d8a74]{opacity:.7}.mk-messaging>.history>a>div>.body>.image[data-v-149d8a74]{display:block;max-height:512px;max-width:100%}.mk-messaging>.no-history[data-v-149d8a74]{color:#999;font-weight:500;margin:0;padding:2em 1em;text-align:center}.mk-messaging>.fetching[data-v-149d8a74]{color:var(--text);margin:0;padding:16px;text-align:center}.mk-messaging>.fetching>[data-icon][data-v-149d8a74]{margin-right:4px}@media (max-width:400px){.mk-messaging>.search>.result>.users>li[data-v-149d8a74]{padding:8px 16px}.mk-messaging>.history>a:not([data-is-me]):not([data-is-read])>div[data-v-149d8a74]{background-image:none;border-left:4px solid #3aa2dc}.mk-messaging>.history>a>div[data-v-149d8a74]{font-size:14px;padding:16px}.mk-messaging>.history>a>div>.avatar[data-v-149d8a74]{margin:0 12px 0 0}}',""]),a.exports=i},74862:(a,e,s)=>{"use strict";s.r(e),s.d(e,{default:()=>o});var t=s(31508),i=s(46813),r=s(95200);const n=t.ZP.extend({i18n:(0,i.Z)("common/views/components/messaging.vue"),props:{compact:{type:Boolean,default:!1},headerTop:{type:Number,default:0}},data:()=>({fetching:!0,moreFetching:!1,messages:[],q:null,result:[],connection:null}),mounted(){this.connection=this.$root.stream.useSharedConnection("messagingIndex"),this.connection.on("message",this.onMessage),this.connection.on("read",this.onRead),this.$root.api("messaging/history").then((a=>{this.messages=a.filter((a=>null==a.user.host&&null==a.recipient.host)),this.fetching=!1}))},beforeDestroy(){this.connection.dispose()},methods:{getAcct:r.Z,isMe(a){return a.userId==this.$store.state.i.id},onMessage(a){this.messages=this.messages.filter((e=>!(e.recipientId==a.recipientId&&e.userId==a.userId||e.recipientId==a.userId&&e.userId==a.recipientId))),this.messages.unshift(a)},onRead(a){for(const e of a){const a=this.messages.find((a=>a.id==e));a&&(a.isRead=!0)}},search(){""!=this.q?this.$root.api("users/search",{query:this.q,localOnly:!0,limit:10,detail:!1}).then((a=>{this.result=a.filter((a=>a.id!=this.$store.state.i.id))})):this.result=[]},navigate(a){this.$emit("navigate",a)},onSearchKeydown(a){switch(a.which){case 9:case 40:a.preventDefault(),a.stopPropagation(),this.$refs.searchResult.childNodes[0].focus()}},onSearchResultKeydown(a,e){const s=this.$refs.searchResult,t=()=>{e.preventDefault(),e.stopPropagation()};switch(!0){case 27==e.which:t(),this.$refs.search.focus();break;case 9==e.which&&e.shiftKey:case 38==e.which:t(),(s.childNodes[a].previousElementSibling||s.childNodes[this.result.length-1]).focus();break;case 9==e.which:case 40==e.which:t(),(s.childNodes[a].nextElementSibling||s.childNodes[0]).focus()}}}});s(37918);const o=(0,s(26385).Z)(n,(function(){var a=this,e=a._self._c;a._self._setupProxy;return e("div",{staticClass:"mk-messaging",attrs:{"data-compact":a.compact}},[a.compact?a._e():e("div",{staticClass:"search",style:{top:a.headerTop+"px"}},[e("div",{staticClass:"form"},[e("label",{attrs:{for:"search-input"}},[e("i",[e("fa",{attrs:{icon:"search"}})],1)]),e("input",{directives:[{name:"model",rawName:"v-model",value:a.q,expression:"q"}],attrs:{type:"search",placeholder:a.$t("search-user")},domProps:{value:a.q},on:{input:[function(e){e.target.composing||(a.q=e.target.value)},a.search],keydown:a.onSearchKeydown}})]),e("div",{staticClass:"result"},[a.result.length>0?e("ol",{ref:"searchResult",staticClass:"users"},a._l(a.result,(function(s,t){return e("li",{attrs:{tabindex:"-1"},on:{keydown:[function(e){return!e.type.indexOf("key")&&a._k(e.keyCode,"enter",13,e.key,"Enter")?null:a.navigate(s)},function(e){return a.onSearchResultKeydown(t)}],click:function(e){return a.navigate(s)}}},[e("mk-avatar",{key:s.id,staticClass:"avatar",attrs:{user:s}}),e("span",{staticClass:"name"},[e("mk-user-name",{key:s.id,attrs:{user:s}})],1),e("span",{staticClass:"username"},[a._v("@"+a._s(a._f("acct")(s)))])],1)})),0):a._e()])]),a.messages.length>0?e("div",{staticClass:"history"},[a._v("\n\t\t最近やりとりしたユーザー\n\t\t"),a._l(a.messages,(function(s){return e("a",{key:s.id,staticClass:"user",attrs:{href:`/i/messaging/${a.getAcct(a.isMe(s)?s.recipient:s.user)}`,"data-is-me":a.isMe(s),"data-is-read":s.isRead},on:{click:function(e){e.preventDefault(),a.navigate(a.isMe(s)?s.recipient:s.user)}}},[e("div",[e("mk-avatar",{staticClass:"avatar",attrs:{user:a.isMe(s)?s.recipient:s.user}}),e("header",[e("span",{staticClass:"name"},[e("mk-user-name",{attrs:{user:a.isMe(s)?s.recipient:s.user}})],1),e("span",{staticClass:"username"},[a._v("@"+a._s(a._f("acct")(a.isMe(s)?s.recipient:s.user)))]),e("mk-time",{attrs:{time:s.createdAt}})],1),e("div",{staticClass:"body"},[e("p",{staticClass:"text"},[a.isMe(s)?e("span",{staticClass:"me"},[a._v(a._s(a.$t("you"))+":")]):a._e(),e("mfm",{attrs:{text:s.text,"custom-emojis":s.emojis}})],1)])],1)])}))],2):a._e(),a.fetching||0!=a.messages.length?a._e():e("p",{staticClass:"no-history"},[a._v(a._s(a.$t("no-history")))]),a.fetching?e("p",{staticClass:"fetching"},[e("fa",{attrs:{icon:"spinner",pulse:"","fixed-width":""}}),a._v(a._s(a.$t("@.loading"))),e("mk-ellipsis")],1):a._e()])}),[],!1,null,"149d8a74",null).exports},37918:(a,e,s)=>{var t=s(32769);t.__esModule&&(t=t.default),"string"==typeof t&&(t=[[a.id,t,""]]),t.locals&&(a.exports=t.locals);(0,s(80950).Z)("5bc0ff16",t,!0,{})}}]);