(self.webpackChunkmisskey=self.webpackChunkmisskey||[]).push([[6327],{75093:(e,t,i)=>{var a=i(11063),r=i(26143)(a);r.push([e.id,'.gvfdktuvdgwhmztnuekzkswkjygptfcv[data-v-3e65dfa6]{border-radius:4px;min-height:180px;padding:8px 0 0}.gvfdktuvdgwhmztnuekzkswkjygptfcv[data-v-3e65dfa6],.gvfdktuvdgwhmztnuekzkswkjygptfcv *[data-v-3e65dfa6]{cursor:pointer}.gvfdktuvdgwhmztnuekzkswkjygptfcv[data-v-3e65dfa6]:hover{background:rgba(0,0,0,.05)}.gvfdktuvdgwhmztnuekzkswkjygptfcv:hover>.label[data-v-3e65dfa6]:after,.gvfdktuvdgwhmztnuekzkswkjygptfcv:hover>.label[data-v-3e65dfa6]:before{background:#0b65a5}.gvfdktuvdgwhmztnuekzkswkjygptfcv:hover>.label.red[data-v-3e65dfa6]:after,.gvfdktuvdgwhmztnuekzkswkjygptfcv:hover>.label.red[data-v-3e65dfa6]:before{background:#c12113}.gvfdktuvdgwhmztnuekzkswkjygptfcv[data-v-3e65dfa6]:active{background:rgba(0,0,0,.1)}.gvfdktuvdgwhmztnuekzkswkjygptfcv:active>.label[data-v-3e65dfa6]:after,.gvfdktuvdgwhmztnuekzkswkjygptfcv:active>.label[data-v-3e65dfa6]:before{background:#0b588c}.gvfdktuvdgwhmztnuekzkswkjygptfcv:active>.label.red[data-v-3e65dfa6]:after,.gvfdktuvdgwhmztnuekzkswkjygptfcv:active>.label.red[data-v-3e65dfa6]:before{background:#ce2212}.gvfdktuvdgwhmztnuekzkswkjygptfcv[data-is-selected][data-v-3e65dfa6]{background:var(--primary)}.gvfdktuvdgwhmztnuekzkswkjygptfcv[data-is-selected][data-v-3e65dfa6]:hover{background:var(--primaryLighten10)}.gvfdktuvdgwhmztnuekzkswkjygptfcv[data-is-selected][data-v-3e65dfa6]:active{background:var(--primaryDarken10)}.gvfdktuvdgwhmztnuekzkswkjygptfcv[data-is-selected]>.label[data-v-3e65dfa6]:after,.gvfdktuvdgwhmztnuekzkswkjygptfcv[data-is-selected]>.label[data-v-3e65dfa6]:before{display:none}.gvfdktuvdgwhmztnuekzkswkjygptfcv[data-is-selected]>.name[data-v-3e65dfa6],.gvfdktuvdgwhmztnuekzkswkjygptfcv[data-is-selected]>.thumbnail[data-v-3e65dfa6]{color:var(--primaryForeground)}.gvfdktuvdgwhmztnuekzkswkjygptfcv[data-is-contextmenu-showing][data-v-3e65dfa6]:after{border:2px dashed var(--primaryAlpha03);border-radius:4px;bottom:-4px;content:"";left:-4px;pointer-events:none;position:absolute;right:-4px;top:-4px}.gvfdktuvdgwhmztnuekzkswkjygptfcv>.label[data-v-3e65dfa6]{left:0;pointer-events:none;position:absolute;top:0}.gvfdktuvdgwhmztnuekzkswkjygptfcv>.label[data-v-3e65dfa6]:after,.gvfdktuvdgwhmztnuekzkswkjygptfcv>.label[data-v-3e65dfa6]:before{background:#0c7ac9;content:"";display:block;position:absolute;z-index:1}.gvfdktuvdgwhmztnuekzkswkjygptfcv>.label[data-v-3e65dfa6]:before{height:8px;left:57px;top:0;width:28px}.gvfdktuvdgwhmztnuekzkswkjygptfcv>.label[data-v-3e65dfa6]:after{height:28px;left:0;top:57px;width:8px}.gvfdktuvdgwhmztnuekzkswkjygptfcv>.label.red[data-v-3e65dfa6]:after,.gvfdktuvdgwhmztnuekzkswkjygptfcv>.label.red[data-v-3e65dfa6]:before{background:#c12113}.gvfdktuvdgwhmztnuekzkswkjygptfcv>.label>img[data-v-3e65dfa6]{left:0;position:absolute;top:0;z-index:2}.gvfdktuvdgwhmztnuekzkswkjygptfcv>.label>p[data-v-3e65dfa6]{color:#fff;left:-28px;line-height:28px;margin:0;position:absolute;text-align:center;top:19px;transform:rotate(-45deg);width:120px;z-index:3}.gvfdktuvdgwhmztnuekzkswkjygptfcv>.thumbnail[data-v-3e65dfa6]{color:var(--driveFileIcon);height:128px;margin:auto;width:128px}.gvfdktuvdgwhmztnuekzkswkjygptfcv>.name[data-v-3e65dfa6]{color:var(--text);display:block;font-size:.8em;margin:4px 0 0;overflow:hidden;text-align:center;word-break:break-all}.gvfdktuvdgwhmztnuekzkswkjygptfcv>.name>.ext[data-v-3e65dfa6]{opacity:.5}',""]),e.exports=r},5757:(e,t,i)=>{var a=i(11063),r=i(26143)(a);r.push([e.id,'.ynntpczxvnusfwdyxsfuhvcmuypqopdd[data-v-249d1d83]{background:var(--desktopDriveFolderBg);border-radius:4px;height:64px;padding:8px}.ynntpczxvnusfwdyxsfuhvcmuypqopdd[data-v-249d1d83],.ynntpczxvnusfwdyxsfuhvcmuypqopdd *[data-v-249d1d83]{cursor:pointer}.ynntpczxvnusfwdyxsfuhvcmuypqopdd *[data-v-249d1d83]{pointer-events:none}.ynntpczxvnusfwdyxsfuhvcmuypqopdd[data-v-249d1d83]:hover{background:var(--desktopDriveFolderHoverBg)}.ynntpczxvnusfwdyxsfuhvcmuypqopdd[data-v-249d1d83]:active{background:var(--desktopDriveFolderActiveBg)}.ynntpczxvnusfwdyxsfuhvcmuypqopdd[data-draghover][data-v-249d1d83]:after,.ynntpczxvnusfwdyxsfuhvcmuypqopdd[data-is-contextmenu-showing][data-v-249d1d83]:after{border:2px dashed var(--primaryAlpha03);border-radius:4px;bottom:-4px;content:"";left:-4px;pointer-events:none;position:absolute;right:-4px;top:-4px}.ynntpczxvnusfwdyxsfuhvcmuypqopdd[data-draghover][data-v-249d1d83]{background:var(--desktopDriveFolderActiveBg)}.ynntpczxvnusfwdyxsfuhvcmuypqopdd>.name[data-v-249d1d83]{color:var(--desktopDriveFolderFg);font-size:.9em;margin:0}.ynntpczxvnusfwdyxsfuhvcmuypqopdd>.name>[data-icon][data-v-249d1d83]{margin-left:2px;margin-right:4px;text-align:left}',""]),e.exports=r},81380:(e,t,i)=>{var a=i(11063),r=i(26143)(a);r.push([e.id,".root.nav-folder>*[data-v-bc9dcd2c]{pointer-events:none}.root.nav-folder[data-draghover][data-v-bc9dcd2c]{background:#eee}.root.nav-folder i.cloud[data-v-bc9dcd2c]{margin-right:4px}",""]),e.exports=r},41e3:(e,t,i)=>{var a=i(11063),r=i(26143)(a);r.push([e.id,".mk-drive>nav[data-v-9327b1b2]{background:var(--face);box-shadow:0 1px 0 rgba(0,0,0,.05);color:var(--text);display:block;font-size:.9em;overflow:auto;width:100%;z-index:2}.mk-drive>nav[data-v-9327b1b2],.mk-drive>nav *[data-v-9327b1b2]{user-select:none}.mk-drive>nav>.path[data-v-9327b1b2]{vertical-align:bottom;white-space:nowrap;width:calc(100% - 200px)}.mk-drive>nav>.path[data-v-9327b1b2],.mk-drive>nav>.path>*[data-v-9327b1b2]{display:inline-block;line-height:38px;margin:0;padding:0 8px}.mk-drive>nav>.path>*[data-v-9327b1b2]{cursor:pointer}.mk-drive>nav>.path>* *[data-v-9327b1b2]{pointer-events:none}.mk-drive>nav>.path[data-v-9327b1b2]>:hover{text-decoration:underline}.mk-drive>nav>.path>.current[data-v-9327b1b2]{cursor:default;font-weight:700}.mk-drive>nav>.path>.current[data-v-9327b1b2]:hover{text-decoration:none}.mk-drive>nav>.path>.separator[data-v-9327b1b2]{cursor:default;margin:0;opacity:.5;padding:0}.mk-drive>nav>.path>.separator>[data-icon][data-v-9327b1b2]{margin:0}.mk-drive>.filter[data-v-9327b1b2]{background:var(--desktopDriveBg);color:var(--text);font-size:.9em;margin:0;padding:.9em}.mk-drive>.main[data-v-9327b1b2]{background:var(--desktopDriveBg);height:calc(100% - 38px);overflow:auto}.mk-drive>.main[data-v-9327b1b2],.mk-drive>.main *[data-v-9327b1b2]{user-select:none}.mk-drive>.main.fetching[data-v-9327b1b2]{cursor:wait!important}.mk-drive>.main.fetching *[data-v-9327b1b2]{pointer-events:none}.mk-drive>.main.fetching>.contents[data-v-9327b1b2]{opacity:.5}.mk-drive>.main.uploading[data-v-9327b1b2]{height:calc(100% - 138px)}.mk-drive>.main>.selection[data-v-9327b1b2]{background:var(--primaryAlpha05);border:1px solid var(--primary);display:none;left:0;pointer-events:none;position:absolute;top:0;z-index:128}.mk-drive>.main>.contents[data-v-9327b1b2]{display:flex;height:100%;overflow:hidden}.mk-drive>.main>.contents>.folders[data-v-9327b1b2]{display:flex;flex-direction:column;overflow-x:hidden;overflow-y:auto;padding:8px;width:200px}.mk-drive>.main>.contents>.empty[data-v-9327b1b2],.mk-drive>.main>.contents>.files[data-v-9327b1b2]{display:flex;flex-wrap:wrap;overflow-y:auto;padding:8px;width:100%}.mk-drive>.main>.contents>.files>.file[data-v-9327b1b2],.mk-drive>.main>.contents>.files>.folder[data-v-9327b1b2],.mk-drive>.main>.contents>.folders>.file[data-v-9327b1b2],.mk-drive>.main>.contents>.folders>.folder[data-v-9327b1b2]{margin:4px;width:144px}.mk-drive>.main>.contents>.files>.padding[data-v-9327b1b2],.mk-drive>.main>.contents>.folders>.padding[data-v-9327b1b2]{flex-grow:1;pointer-events:none;width:152px}.mk-drive>.main>.contents>.empty[data-v-9327b1b2]{color:#999;justify-content:center;padding:16px;pointer-events:none}.mk-drive>.main>.contents>.empty>p[data-v-9327b1b2]{margin:0}.mk-drive>.main>.fetching .spinner[data-v-9327b1b2]{animation:sk-rotate-9327b1b2 2s linear infinite;height:40px;margin:100px auto;text-align:center;width:40px}.mk-drive>.main>.fetching .dot1[data-v-9327b1b2],.mk-drive>.main>.fetching .dot2[data-v-9327b1b2]{animation:sk-bounce-9327b1b2 2s ease-in-out infinite;background-color:rgba(0,0,0,.3);border-radius:100%;display:inline-block;height:60%;position:absolute;top:0;width:60%}.mk-drive>.main>.fetching .dot2[data-v-9327b1b2]{animation-delay:-1s;bottom:0;top:auto}@-moz-keyframes sk-rotate-9327b1b2{to{transform:rotate(1turn)}}@-webkit-keyframes sk-rotate-9327b1b2{to{transform:rotate(1turn)}}@-o-keyframes sk-rotate-9327b1b2{to{transform:rotate(1turn)}}@keyframes sk-rotate-9327b1b2{to{transform:rotate(1turn)}}@-moz-keyframes sk-bounce-9327b1b2{0%,to{transform:scale(0)}50%{transform:scale(1)}}@-webkit-keyframes sk-bounce-9327b1b2{0%,to{transform:scale(0)}50%{transform:scale(1)}}@-o-keyframes sk-bounce-9327b1b2{0%,to{transform:scale(0)}50%{transform:scale(1)}}@keyframes sk-bounce-9327b1b2{0%,to{transform:scale(0)}50%{transform:scale(1)}}.mk-drive>.dropzone[data-v-9327b1b2]{border:2px dashed var(--primaryAlpha05);height:calc(100% - 38px);left:0;pointer-events:none;position:absolute;top:38px;width:100%}.mk-drive>.mk-uploader[data-v-9327b1b2]{height:100px;padding:16px}.mk-drive>input[data-v-9327b1b2]{display:none}",""]),e.exports=r},17231:(e,t,i)=>{"use strict";i.d(t,{Z:()=>r});var a=i(87114);const r=e=>{const t=t=>e.api("i/update",{avatarId:t.id}).then((t=>(e.$store.commit("updateIKeyValue",{key:"avatarId",value:t.avatarId}),e.$store.commit("updateIKeyValue",{key:"avatarUrl",value:t.avatarUrl}),e.dialog({title:a.SP.desktop["avatar-updated"],text:null}),t))).catch((t=>{if("f419f9f8-2f4d-46b1-9fb4-49d3a2fd7191"===t.id)e.dialog({type:"error",title:a.SP.desktop["unable-to-process"],text:a.SP.desktop["invalid-filetype"]});else e.dialog({type:"error",text:a.SP.desktop["unable-to-process"]})}));return(i=null)=>(i?Promise.resolve(i):e.$chooseDriveFile({multiple:!1,type:"image/*",title:a.SP.desktop["choose-avatar"]})).then(t).catch((e=>e&&console.warn(e)))}},20232:(e,t,i)=>{"use strict";i.d(t,{Z:()=>r});var a=i(87114);const r=e=>{const t=t=>e.api("i/update",{bannerId:t.id}).then((t=>(e.$store.commit("updateIKeyValue",{key:"bannerId",value:t.bannerId}),e.$store.commit("updateIKeyValue",{key:"bannerUrl",value:t.bannerUrl}),e.dialog({title:a.SP.desktop["banner-updated"],text:null}),t))).catch((t=>{if("75aedb19-2afd-4e6d-87fc-67941256fa60"===t.id)e.dialog({type:"error",title:a.SP.desktop["unable-to-process"],text:a.SP.desktop["invalid-filetype"]});else e.dialog({type:"error",text:a.SP.desktop["unable-to-process"]})}));return(i=null)=>(i?Promise.resolve(i):e.$chooseDriveFile({multiple:!1,type:"image/*",title:a.SP.desktop["choose-banner"]})).then(t).catch((e=>e&&console.warn(e)))}},66327:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>$});var a=i(31508),r=i(46813),o=i(12183);const d=a.ZP.extend({i18n:(0,r.Z)(),props:["folder"],data:()=>({hover:!1,draghover:!1}),computed:{browser(){return this.$parent}},methods:{onClick(){this.browser.move(this.folder)},onMouseover(){this.hover=!0},onMouseout(){this.hover=!1},onDragover(e){null==this.folder&&null==this.browser.folder&&(e.dataTransfer.dropEffect="none");const t="file"==e.dataTransfer.items[0].kind,i="mk_drive_file"==e.dataTransfer.types[0],a="mk_drive_folder"==e.dataTransfer.types[0];return e.dataTransfer.dropEffect=t||i||a?"all"==e.dataTransfer.effectAllowed?"copy":"move":"none",!1},onDragenter(){(this.folder||this.browser.folder)&&(this.draghover=!0)},onDragleave(){(this.folder||this.browser.folder)&&(this.draghover=!1)},onDrop(e){if(this.draghover=!1,e.dataTransfer.files.length>0){for(const t of Array.from(e.dataTransfer.files))this.browser.upload(t,this.folder);return}const t=e.dataTransfer.getData("mk_drive_file");if(null!=t&&""!=t){const e=JSON.parse(t);this.browser.removeFile(e.id),this.$root.api("drive/files/update",{fileId:e.id,folderId:this.folder?this.folder.id:null})}const i=e.dataTransfer.getData("mk_drive_folder");if(null!=i&&""!=i){const e=JSON.parse(i);if(this.folder&&e.id==this.folder.id)return;this.browser.removeFolder(e.id),this.$root.api("drive/folders/update",{folderId:e.id,parentId:this.folder?this.folder.id:null})}}}});i(25154);var n=i(26385);const s=(0,n.Z)(d,(function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",{staticClass:"root nav-folder",attrs:{"data-draghover":e.draghover},on:{click:e.onClick,dragover:function(t){return t.preventDefault(),t.stopPropagation(),e.onDragover.apply(null,arguments)},dragenter:e.onDragenter,dragleave:e.onDragleave,drop:function(t){return t.stopPropagation(),e.onDrop.apply(null,arguments)}}},[null==e.folder?t("i",{staticClass:"cloud"},[t("fa",{attrs:{icon:"cloud"}})],1):e._e(),t("span",[e._v(e._s(null==e.folder?e.$t("@.drive"):e.folder.name))])])}),[],!1,null,"bc9dcd2c",null).exports;const l=a.ZP.extend({i18n:(0,r.Z)("desktop/views/components/drive.folder.vue"),props:["folder","parent"],data:()=>({hover:!1,draghover:!1,isDragging:!1,isContextmenuShowing:!1}),computed:{browser(){return this.$parent},title(){var e;return(null===(e=this.folder)||void 0===e?void 0:e.name)||".."}},methods:{onClick(){this.browser.move(this.folder)},onContextmenu(e){this.isContextmenuShowing=!0,this.$contextmenu(e,[{type:"item",text:this.$t("contextmenu.move-to-this-folder"),icon:"arrow-right",action:this.go},{type:"item",text:this.$t("contextmenu.show-in-new-window"),icon:["far","window-restore"],action:this.newWindow},...this.folder?[null,{type:"item",text:this.$t("contextmenu.rename"),icon:"i-cursor",action:this.rename},null,{type:"item",text:this.$t("@.delete"),icon:["far","trash-alt"],action:this.deleteFolder}]:[]],{closed:()=>{this.isContextmenuShowing=!1}})},onMouseover(){this.hover=!0},onMouseout(){this.hover=!1},onDragover(e){if(this.isDragging)return void(e.dataTransfer.dropEffect="none");const t="file"==e.dataTransfer.items[0].kind,i="mk_drive_file"==e.dataTransfer.types[0],a="mk_drive_folder"==e.dataTransfer.types[0];e.dataTransfer.dropEffect=t||i||a?"all"==e.dataTransfer.effectAllowed?"copy":"move":"none"},onDragenter(){this.isDragging||(this.draghover=!0)},onDragleave(){this.draghover=!1},onDrop(e){var t,i,a;if(this.draghover=!1,e.dataTransfer.files.length>0){for(const t of Array.from(e.dataTransfer.files))this.browser.upload(t,this.folder);return}const r=e.dataTransfer.getData("mk_drive_file");if(null!=r&&""!=r){const e=JSON.parse(r);this.browser.removeFile(e.id),this.$root.api("drive/files/update",{fileId:e.id,folderId:(null===(t=this.folder)||void 0===t?void 0:t.id)||null})}const o=e.dataTransfer.getData("mk_drive_folder");if(null!=o&&""!=o){const e=JSON.parse(o);if(e.id==(null===(i=this.folder)||void 0===i?void 0:i.id))return;this.browser.removeFolder(e.id),this.$root.api("drive/folders/update",{folderId:e.id,parentId:(null===(a=this.folder)||void 0===a?void 0:a.id)||null}).then((()=>{})).catch((e=>{if("detected-circular-definition"===e)this.$root.dialog({title:this.$t("unable-to-process"),text:this.$t("circular-reference-detected")});else alert(this.$t("unhandled-error"))}))}},onDragstart(e){e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("mk_drive_folder",JSON.stringify(this.folder)),this.isDragging=!0,this.browser.isDragSource=!0},onDragend(){this.isDragging=!1,this.browser.isDragSource=!1},go(){var e;this.browser.move((null===(e=this.folder)||void 0===e?void 0:e.id)||null)},newWindow(){this.browser.newWindow(this.folder)},rename(){this.$root.dialog({title:this.$t("contextmenu.rename-folder"),input:{placeholder:this.$t("contextmenu.input-new-folder-name"),default:this.folder.name}}).then((({canceled:e,result:t})=>{e||this.$root.api("drive/folders/update",{folderId:this.folder.id,name:t})}))},deleteFolder(){this.$root.api("drive/folders/delete",{folderId:this.folder.id}).catch((e=>{this.$root.dialog({type:"error",title:"Error",text:e.message||e})}))}}});i(71567);const f=(0,n.Z)(l,(function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",{staticClass:"ynntpczxvnusfwdyxsfuhvcmuypqopdd",attrs:{"data-is-contextmenu-showing":e.isContextmenuShowing,"data-draghover":e.draghover,draggable:"true",title:e.title},on:{click:e.onClick,mouseover:e.onMouseover,mouseout:e.onMouseout,dragover:function(t){return t.preventDefault(),t.stopPropagation(),e.onDragover.apply(null,arguments)},dragenter:function(t){return t.preventDefault(),e.onDragenter.apply(null,arguments)},dragleave:e.onDragleave,drop:function(t){return t.preventDefault(),t.stopPropagation(),e.onDrop.apply(null,arguments)},dragstart:e.onDragstart,dragend:e.onDragend,contextmenu:function(t){return t.preventDefault(),t.stopPropagation(),e.onContextmenu.apply(null,arguments)}}},[t("p",{staticClass:"name"},[e.hover?[t("fa",{attrs:{icon:["far","folder-open"],"fixed-width":""}})]:e._e(),e.hover?e._e():[t("fa",{attrs:{icon:["far","folder"],"fixed-width":""}})],e._v("\n\t\t"+e._s(this.parent?"..":e.folder.name)+"\n\t")],2)])}),[],!1,null,"249d1d83",null).exports;var h=i(83918),p=i(17231),c=i(20232),v=i(21892),u=i(44516),m=i(38154),g=i(3123),k=i(32971);const b=a.ZP.extend({i18n:(0,r.Z)("desktop/views/components/drive.file.vue"),props:["file"],components:{XFileThumbnail:v.Z,ImageViewer:u.Z,MkMediaVideoDialog:m.Z},data:()=>({isContextmenuShowing:!1,isDragging:!1,faImages:g.l9,faExternalLinkAlt:k.Xjp}),computed:{browser(){return this.$parent},isSelected(){return this.browser.selectedFiles.some((e=>e.id==this.file.id))},title(){return`${this.file.name}\n${this.file.type}`}},methods:{onClick(){this.browser.chooseFile(this.file)},onContextmenu(e){this.isContextmenuShowing=!0,this.$contextmenu(e,[...this.file.type.startsWith("image/")||this.file.type.startsWith("video/")?[{type:"item",text:this.$t("contextmenu.view"),icon:g.l9,action:this.view}]:[{type:"link",href:this.file.url,target:"_blank",text:this.$t("contextmenu.open"),icon:k.Xjp}],{type:"item",text:this.$t("contextmenu.copy-url"),icon:"link",action:this.copyUrl},null,{type:"item",text:this.$t("contextmenu.rename"),icon:"i-cursor",action:this.rename},{type:"item",text:this.file.isSensitive?this.$t("contextmenu.unmark-as-sensitive"):this.$t("contextmenu.mark-as-sensitive"),icon:this.file.isSensitive?["far","eye"]:["far","eye-slash"],action:this.toggleSensitive},null,{type:"item",text:this.$t("@.delete"),icon:["far","trash-alt"],action:this.deleteFile},null,{type:"nest",text:this.$t("contextmenu.else-files"),menu:[{type:"item",text:this.$t("contextmenu.set-as-avatar"),action:this.setAsAvatar},{type:"item",text:this.$t("contextmenu.set-as-banner"),action:this.setAsBanner}]}],{closed:()=>{this.isContextmenuShowing=!1}})},onDragstart(e){e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("mk_drive_file",JSON.stringify(this.file)),this.isDragging=!0,this.browser.isDragSource=!0},onDragend(e){this.isDragging=!1,this.browser.isDragSource=!1},onThumbnailLoaded(){},rename(){this.$root.dialog({title:this.$t("contextmenu.rename-file"),input:{placeholder:this.$t("contextmenu.input-new-file-name"),default:this.file.name,allowEmpty:!1}}).then((({canceled:e,result:t})=>{e||this.$root.api("drive/files/update",{fileId:this.file.id,name:t})}))},toggleSensitive(){this.$root.api("drive/files/update",{fileId:this.file.id,isSensitive:!this.file.isSensitive})},view(){const e=this.file.type.startsWith("image/")?this.$root.new(u.Z,{image:this.file}):this.$root.new(m.Z,{video:this.file,start:0});this.$once("hook:beforeDestroy",(()=>{e.close()}))},copyUrl(){(0,h.Z)(this.file.url),this.$root.dialog({title:this.$t("contextmenu.copied"),text:this.$t("contextmenu.copied-url-to-clipboard")})},setAsAvatar(){(0,p.Z)(this.$root)(this.file)},setAsBanner(){(0,c.Z)(this.$root)(this.file)},addApp(){alert("not implemented yet")},deleteFile(){this.$root.api("drive/files/delete",{fileId:this.file.id})}}});i(80184);const y=(0,n.Z)(b,(function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",{staticClass:"gvfdktuvdgwhmztnuekzkswkjygptfcv",attrs:{"data-is-selected":e.isSelected,"data-is-contextmenu-showing":e.isContextmenuShowing,draggable:"true",title:e.title},on:{click:e.onClick,dragstart:e.onDragstart,dragend:e.onDragend,contextmenu:function(t){return t.preventDefault(),t.stopPropagation(),e.onContextmenu.apply(null,arguments)}}},[e.$store.state.i.avatarId==e.file.id?t("div",{staticClass:"label"},[t("img",{attrs:{src:"/assets/label.svg"}}),t("p",[e._v(e._s(e.$t("avatar")))])]):e._e(),e.$store.state.i.bannerId==e.file.id?t("div",{staticClass:"label"},[t("img",{attrs:{src:"/assets/label.svg"}}),t("p",[e._v(e._s(e.$t("banner")))])]):e._e(),e.file.isSensitive?t("div",{staticClass:"label red"},[t("img",{attrs:{src:"/assets/label-red.svg"}}),t("p",[e._v(e._s(e.$t("nsfw")))])]):e._e(),t("x-file-thumbnail",{staticClass:"thumbnail",attrs:{file:e.file,fit:"contain"}}),t("p",{staticClass:"name"},[t("span",[e._v(e._s(-1!=e.file.name.lastIndexOf(".")?e.file.name.substr(0,e.file.name.lastIndexOf(".")):e.file.name))]),-1!=e.file.name.lastIndexOf(".")?t("span",{staticClass:"ext"},[e._v(e._s(e.file.name.substr(e.file.name.lastIndexOf("."))))]):e._e()])],1)}),[],!1,null,"3e65dfa6",null).exports;var x=i(10492),w=i(87114);const _=a.ZP.extend({i18n:(0,r.Z)("desktop/views/components/drive.vue"),components:{XNavFolder:s,XFolder:f,XFile:y},props:{initFolder:{type:Object,required:!1},type:{type:String,required:!1,default:()=>""},attached:{type:String,required:!1,default:()=>"all"},multiple:{type:Boolean,default:!1}},data:()=>({folder:null,files:[],folders:[],moreFiles:!1,moreFolders:!1,hierarchyFolders:[],selectedFiles:[],uploadings:[],connection:null,draghover:!1,isDragSource:!1,fetching:!0}),mounted(){this.connection=this.$root.stream.useSharedConnection("drive"),this.connection.on("fileCreated",this.onStreamDriveFileCreated),this.connection.on("fileUpdated",this.onStreamDriveFileUpdated),this.connection.on("fileDeleted",this.onStreamDriveFileDeleted),this.connection.on("folderCreated",this.onStreamDriveFolderCreated),this.connection.on("folderUpdated",this.onStreamDriveFolderUpdated),this.connection.on("folderDeleted",this.onStreamDriveFolderDeleted),this.initFolder?this.move(this.initFolder):this.fetch()},beforeDestroy(){this.connection.dispose()},watch:{attached(){this.fetch()},type(){this.fetch()}},computed:{parentFolder(){return this.hierarchyFolders[this.hierarchyFolders.length-1]}},methods:{onContextmenu(e){this.$contextmenu(e,[{type:"item",text:this.$t("contextmenu.create-folder"),icon:["far","folder"],action:this.createFolder},{type:"item",text:this.$t("contextmenu.upload"),icon:"upload",action:this.selectLocalFile},{type:"item",text:this.$t("contextmenu.url-upload"),icon:k.r6c,action:this.urlUpload}])},onStreamDriveFileCreated(e){this.addFile(e,!0)},onStreamDriveFileUpdated(e){(this.folder?this.folder.id:null)!=e.folderId?this.removeFile(e):this.addFile(e,!0)},onStreamDriveFileDeleted(e){this.removeFile(e)},onStreamDriveFolderCreated(e){this.addFolder(e,!0)},onStreamDriveFolderUpdated(e){(this.folder?this.folder.id:null)!=e.parentId?this.removeFolder(e):this.addFolder(e,!0)},onStreamDriveFolderDeleted(e){this.removeFolder(e)},onChangeUploaderUploads(e){this.uploadings=e},onUploaderUploaded(e){this.addFile(e,!0)},onMousedown(e){if((0,x.Z)(this.$refs.foldersContainer,e.target)||(0,x.Z)(this.$refs.filesContainer,e.target))return!0;const t=this.$refs.main,i=this.$refs.selection,a=t.getBoundingClientRect(),r=e.pageX+t.scrollLeft-a.left-window.pageXOffset,o=e.pageY+t.scrollTop-a.top-window.pageYOffset,d=e=>{i.style.display="block";const d=e.pageX+t.scrollLeft-a.left-window.pageXOffset,n=e.pageY+t.scrollTop-a.top-window.pageYOffset,s=d-r,l=n-o;s>0?(i.style.width=s+"px",i.style.left=r+"px"):(i.style.width=-s+"px",i.style.left=d+"px"),l>0?(i.style.height=l+"px",i.style.top=o+"px"):(i.style.height=-l+"px",i.style.top=n+"px")},n=e=>{document.documentElement.removeEventListener("mousemove",d),document.documentElement.removeEventListener("mouseup",n),i.style.display="none"};document.documentElement.addEventListener("mousemove",d),document.documentElement.addEventListener("mouseup",n)},onDragover(e){if(this.isDragSource)return void(e.dataTransfer.dropEffect="none");const t="file"==e.dataTransfer.items[0].kind,i="mk_drive_file"==e.dataTransfer.types[0],a="mk_drive_folder"==e.dataTransfer.types[0];return e.dataTransfer.dropEffect=t||i||a?"all"==e.dataTransfer.effectAllowed?"copy":"move":"none",!1},onDragenter(e){this.isDragSource||(this.draghover=!0)},onDragleave(e){this.draghover=!1},onDrop(e){if(this.draghover=!1,e.dataTransfer.files.length>0){for(const t of Array.from(e.dataTransfer.files))this.upload(t,this.folder);return}const t=e.dataTransfer.getData("mk_drive_file");if(null!=t&&""!=t){const e=JSON.parse(t);if(this.files.some((t=>t.id==e.id)))return;this.removeFile(e.id),this.$root.api("drive/files/update",{fileId:e.id,folderId:this.folder?this.folder.id:null})}const i=e.dataTransfer.getData("mk_drive_folder");if(null!=i&&""!=i){const e=JSON.parse(i);if(this.folder&&e.id==this.folder.id)return!1;if(this.folders.some((t=>t.id==e.id)))return!1;this.removeFolder(e.id),this.$root.api("drive/folders/update",{folderId:e.id,parentId:this.folder?this.folder.id:null}).then((()=>{})).catch((e=>{if("detected-circular-definition"===e)this.$root.dialog({title:this.$t("unable-to-process"),text:this.$t("circular-reference-detected")});else alert(this.$t("unhandled-error"))}))}},selectLocalFile(){this.$refs.fileInput.click()},urlUpload(){this.$root.dialog({title:this.$t("url-upload"),input:{placeholder:this.$t("url-of-file")}}).then((({canceled:e,result:t})=>{e||(this.$root.api("drive/files/upload_from_url",{url:t,folderId:this.folder?this.folder.id:void 0}),this.$root.dialog({title:this.$t("url-upload-requested"),text:this.$t("may-take-time")}))}))},createFolder(){this.$root.dialog({title:this.$t("create-folder"),input:{placeholder:this.$t("folder-name")}}).then((({canceled:e,result:t})=>{e||this.$root.api("drive/folders/create",{name:t,parentId:this.folder?this.folder.id:void 0}).then((e=>{this.addFolder(e,!0)}))}))},onChangeFileInput(){for(const e of Array.from(this.$refs.fileInput.files))this.upload(e,this.folder)},upload(e,t){t&&"object"==typeof t&&(t=t.id),this.$refs.uploader.upload(e,t)},chooseFile(e){const t=this.selectedFiles.some((t=>t.id==e.id));this.multiple?(t?this.selectedFiles=this.selectedFiles.filter((t=>t.id!=e.id)):this.selectedFiles.push(e),this.$emit("change-selection",this.selectedFiles)):t?this.$emit("selected",e):(this.selectedFiles=[e],this.$emit("change-selection",[e]))},newWindow(e){document.body.clientWidth>800?this.$root.new(o.Z,{folder:e}):window.open(`${w.HQ}/i/drive/folder/${e.id}`,"drive_window","height=500, width=800")},move(e){null!=e?("object"==typeof e&&(e=e.id),this.fetching=!0,this.$root.api("drive/folders/show",{folderId:e}).then((e=>{this.folder=e,this.hierarchyFolders=[];const t=e=>{this.hierarchyFolders.unshift(e),e.parent&&t(e.parent)};e.parent&&t(e.parent),this.$emit("open-folder",e),this.fetch()}))):this.goRoot()},addFolder(e,t=!1){if((this.folder?this.folder.id:null)==e.parentId)if(this.folders.some((t=>t.id==e.id))){const t=this.folders.map((e=>e.id)).indexOf(e.id);a.ZP.set(this.folders,t,e)}else t?this.folders.unshift(e):this.folders.push(e)},addFile(e,t=!1){if((this.folder?this.folder.id:null)==e.folderId)if(this.files.some((t=>t.id==e.id))){const t=this.files.map((e=>e.id)).indexOf(e.id);a.ZP.set(this.files,t,e)}else t?this.files.unshift(e):this.files.push(e)},removeFolder(e){"object"==typeof e&&(e=e.id),this.folders=this.folders.filter((t=>t.id!=e))},removeFile(e){"object"==typeof e&&(e=e.id),this.files=this.files.filter((t=>t.id!=e))},appendFile(e){this.addFile(e)},appendFolder(e){this.addFolder(e)},prependFile(e){this.addFile(e,!0)},prependFolder(e){this.addFolder(e,!0)},goRoot(){null!=this.folder&&(this.folder=null,this.hierarchyFolders=[],this.$emit("move-root"),this.fetch())},fetch(){this.folders=[],this.files=[],this.moreFolders=!1,this.moreFiles=!1,this.fetching=!0;let e=null,t=null;this.$root.api("drive/folders",{folderId:this.folder?this.folder.id:null,limit:25}).then((t=>{25==t.length&&(this.moreFolders=!0,t.pop()),e=t,a()})),this.$root.api("drive/files",{folderId:this.folder?this.folder.id:null,attached:this.attached,type:this.type||void 0,limit:25}).then((e=>{25==e.length&&(this.moreFiles=!0,e.pop()),t=e,a()}));let i=!1;const a=()=>{if(i){for(const t of e)this.appendFolder(t);for(const e of t)this.appendFile(e);this.fetching=!1}else i=!0}},fetchMoreFiles(){this.fetching=!0;this.$root.api("drive/files",{folderId:this.folder?this.folder.id:null,attached:this.attached,type:this.type||void 0,untilId:this.files[this.files.length-1].id,limit:25}).then((e=>{25==e.length?(this.moreFiles=!0,e.pop()):this.moreFiles=!1;for(const t of e)this.appendFile(t);this.fetching=!1}))}}});i(86505);const $=(0,n.Z)(_,(function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",{staticClass:"mk-drive"},[t("nav",[t("div",{staticClass:"path",on:{contextmenu:function(e){return e.preventDefault(),e.stopPropagation(),(()=>{}).apply(null,arguments)}}},[t("x-nav-folder",{class:{current:null==e.folder}}),e._l(e.hierarchyFolders,(function(e){return[t("span",{staticClass:"separator"},[t("fa",{attrs:{icon:"angle-right"}})],1),t("x-nav-folder",{key:e.id,attrs:{folder:e}})]})),null!=e.folder?t("span",{staticClass:"separator"},[t("fa",{attrs:{icon:"angle-right"}})],1):e._e(),null!=e.folder?t("span",{staticClass:"folder current"},[e._v(e._s(e.folder.name))]):e._e()],2)]),t("ui-horizon-group",{staticClass:"filter"},[t("ui-select",{model:{value:e.attached,callback:function(t){e.attached=t},expression:"attached"}},[t("option",{attrs:{value:"all"}},[e._v(e._s(e.$t("@.allAttached")))]),t("option",{attrs:{value:"attached"}},[e._v(e._s(e.$t("@.attached")))]),t("option",{attrs:{value:"notAttached"}},[e._v(e._s(e.$t("@.notAttached")))])]),t("ui-select",{model:{value:e.type,callback:function(t){e.type=t},expression:"type"}},[t("option",{attrs:{value:""}},[e._v(e._s(e.$t("@.allType")))]),t("option",{attrs:{value:"image/*"}},[e._v(e._s(e.$t("@.image")))]),t("option",{attrs:{value:"video/*"}},[e._v(e._s(e.$t("@.video")))]),t("option",{attrs:{value:"audio/*"}},[e._v(e._s(e.$t("@.audio")))])])],1),t("div",{ref:"main",staticClass:"main",class:{uploading:e.uploadings.length>0,fetching:e.fetching},on:{mousedown:e.onMousedown,dragover:function(t){return t.preventDefault(),t.stopPropagation(),e.onDragover.apply(null,arguments)},dragenter:e.onDragenter,dragleave:e.onDragleave,drop:function(t){return t.preventDefault(),t.stopPropagation(),e.onDrop.apply(null,arguments)},contextmenu:function(t){return t.preventDefault(),t.stopPropagation(),e.onContextmenu.apply(null,arguments)}}},[t("div",{ref:"selection",staticClass:"selection"}),t("div",{ref:"contents",staticClass:"contents"},[t("div",{ref:"foldersContainer",staticClass:"folders"},[null!=e.folder?t("x-folder",{key:e.parentFolder?e.parentFolder.id:null,staticClass:"folder",attrs:{folder:e.parentFolder,parent:!0}}):e._e(),e._l(e.folders,(function(e){return t("x-folder",{key:e.id,staticClass:"folder",attrs:{folder:e}})})),e.moreFolders?t("ui-button",[e._v(e._s(e.$t("@.load-more")))]):e._e()],2),e.files.length>0||e.moreFiles?t("div",{ref:"filesContainer",staticClass:"files"},[e._l(e.files,(function(e){return t("x-file",{key:e.id,staticClass:"file",attrs:{file:e}})})),e.moreFiles?t("ui-button",{on:{click:e.fetchMoreFiles}},[e._v(e._s(e.$t("@.load-more")))]):e._e()],2):e.fetching?e._e():t("div",{staticClass:"empty"},[e.draghover?t("p",[e._v(e._s(e.$t("empty-draghover")))]):t("p",[e._v(e._s(e.$t("empty-folder")))])])]),e.fetching?t("div",{staticClass:"fetching"},[e._m(0)]):e._e()]),e.draghover?t("div",{staticClass:"dropzone"}):e._e(),t("mk-uploader",{ref:"uploader",on:{change:e.onChangeUploaderUploads,uploaded:e.onUploaderUploaded}}),t("input",{ref:"fileInput",attrs:{type:"file",accept:"*/*",multiple:"multiple",tabindex:"-1"},on:{change:e.onChangeFileInput}})],1)}),[function(){var e=this._self._c;this._self._setupProxy;return e("div",{staticClass:"spinner"},[e("div",{staticClass:"dot1"}),e("div",{staticClass:"dot2"})])}],!1,null,"9327b1b2",null).exports},80184:(e,t,i)=>{var a=i(75093);a.__esModule&&(a=a.default),"string"==typeof a&&(a=[[e.id,a,""]]),a.locals&&(e.exports=a.locals);(0,i(80950).Z)("e40fce74",a,!0,{})},71567:(e,t,i)=>{var a=i(5757);a.__esModule&&(a=a.default),"string"==typeof a&&(a=[[e.id,a,""]]),a.locals&&(e.exports=a.locals);(0,i(80950).Z)("395344ce",a,!0,{})},25154:(e,t,i)=>{var a=i(81380);a.__esModule&&(a=a.default),"string"==typeof a&&(a=[[e.id,a,""]]),a.locals&&(e.exports=a.locals);(0,i(80950).Z)("acdb6b48",a,!0,{})},86505:(e,t,i)=>{var a=i(41e3);a.__esModule&&(a=a.default),"string"==typeof a&&(a=[[e.id,a,""]]),a.locals&&(e.exports=a.locals);(0,i(80950).Z)("69f631ec",a,!0,{})}}]);