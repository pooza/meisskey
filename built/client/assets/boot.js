"use strict";!async function(){if("true"==localStorage.getItem("shouldFlush"))return void h();const e=["cs-CZ","de-DE","en-US","es-ES","fr-FR","ja-JP","ja-KS","ko-KR","nl-NL","pl-PL","zh-CN","zh-TW"],t=localStorage.getItem("theme");if(t)for(const[e,a]of Object.entries(JSON.parse(t)))document.documentElement.style.setProperty(`--${e}`,a.toString());let a=null;const o=localStorage.getItem("vuex");o&&(a=JSON.parse(o));const l=new URL(location.href);let n=null;`${l.pathname}/`.startsWith("/docs/")&&(n="docs"),`${l.pathname}/`.startsWith("/dev/")&&(n="dev"),`${l.pathname}/`.startsWith("/auth/")&&(n="auth"),`${l.pathname}/`.startsWith("/admin/")&&(n="admin");const s=localStorage.getItem("v")||"10.102.662-m544";let i=null;e.includes(navigator.language)?i=navigator.language:(i=e.find((e=>e.split("-")[0]==navigator.language)),null==i&&(i="en-US")),a&&a.device.lang&&e.includes(a.device.lang)&&(i=a.device.lang),localStorage.setItem("lang",i);const c=localStorage.getItem("locale"),r=localStorage.getItem("localeKey");if(null==c||r!=`${s}.${i}`){const e=await fetch(`/assets/locales/${i}.json?ver=${s}`).then((e=>e.json()));localStorage.setItem("locale",JSON.stringify(e)),localStorage.setItem("localeKey",`${s}.${i}`)}const m=navigator.userAgent.toLowerCase();let d=/mobile|iphone|ipad|android/.test(m);a&&a.device.appType&&("mobile"===a.device.appType?d=!0:"desktop"===a.device.appType&&(d=!1));const g=document.getElementsByTagName("head")[0];if(d){const e=document.createElement("meta");e.setAttribute("name","viewport"),e.setAttribute("content","width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no"),g.appendChild(e)}null==n&&(n=d?"mobile":"desktop");const u=document.createElement("script");function h(){localStorage.setItem("shouldFlush","false"),localStorage.removeItem("locale");try{navigator.serviceWorker.controller.postMessage("clear"),navigator.serviceWorker.getRegistrations().then((e=>{for(const t of e)t.unregister()}))}catch(e){console.error(e)}location.reload(!0)}u.setAttribute("src",`/assets/${n}.${s}.js`),u.setAttribute("defer","true"),g.appendChild(u),window.mkBootTimer=window.setTimeout((async()=>{const e=await fetch("/api/meta",{method:"POST",cache:"no-cache"}),t=await e.json();t.version!=s&&(localStorage.setItem("v",t.version),alert("Misskeyの新しいバージョンがあります。ページを再度読み込みします。\n\nNew version of Misskey available. The page will be reloaded."),h())}),3e3)}();