{"version":3,"sources":["models/drive-file.js"],"names":["DriveFileChunk","getDriveFileBucket","validateFileName","packMany","pack","DriveFile","db","get","createIndex","nativeDbConn","bucket","mongo","GridFSBucket","bucketName","name","trim","length","indexOf","files","options","Promise","all","map","f","file","opts","Object","assign","detail","self","_file","isObjectId","findOne","_id","ObjectID","deepcopy","dbLogger","warn","_target","id","createdAt","uploadDate","filename","type","contentType","animation","datasize","size","md5","url","sanitizeUrl","getDriveFileUrl","thumbnailUrl","properties","metadata","comment","deletedAt","isSensitive","folderId","folder","packFolder","withUser","userId","user","packUser","webpublicUrl","getOriginalUrl","attachedNoteIds","attachedMessageIds"],"mappings":"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","file":"drive-file.js","sourceRoot":"../../built"}