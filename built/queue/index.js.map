{"version":3,"sources":["queue/index.js"],"names":["deliver","webpushDeliver","inbox","createDeleteNotesJob","createDeleteDriveFilesJob","createDeleteNoteJob","createDeleteSigninsJob","createExpireMuteJob","createNotifyPollFinishedJob","createExportNotesJob","createExportFollowingJob","createExportMuteJob","createExportBlockingJob","createExportUserListsJob","createImportFollowingJob","createImportBlockingJob","createImportMuteJob","createImportUserListsJob","destroy","deliverLogger","queueLogger","createSubLogger","webpushDeliverLogger","inboxLogger","dbLogger","deliverDeltaCounts","inboxDeltaCounts","deliverQueue","on","jobId","debug","job","info","getJobInfo","data","to","result","err","msg","log","warn","error","webpushDeliverQueue","pushSubscription","endpoint","inboxQueue","activity","id","dbQueue","name","setInterval","queueChart","update","user","content","lowSeverity","inboxInfo","config","disableFederation","attempts","deliverJobMaxAttempts","_id","keypair","add","timeout","backoff","type","removeOnComplete","removeOnFail","signature","request","inboxJobMaxAttempts","note","delay","noteId","mute","expiresAt","getTime","Date","now","muteId","userId","fileId","process","deliverJobConcurrency","processDeliver","processWebpushDeliver","inboxJobConcurrency","processInbox","processDb","domain","once","jobs","status","succ","length","clean"],"mappings":"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","file":"index.js","sourceRoot":"../../built"}