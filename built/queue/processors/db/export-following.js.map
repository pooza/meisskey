{"version":3,"sources":["queue/processors/db/export-following.js"],"names":["exportFollowing","logger","queueLogger","createSubLogger","job","info","data","user","_id","User","findOne","mongo","ObjectID","toString","path","cleanup","Promise","res","rej","tmp","file","e","fd","stream","fs","createWriteStream","flags","exportedCount","cursor","total","Following","count","followerId","followings","find","$gt","limit","sort","length","progress","following","u","followeeId","fields","username","host","content","getFullApAccount","write","err","error","end","succ","fileName","format","Date","driveFile","addFile","name","force"],"mappings":";+BAesBA;;;eAAAA;;;qBAdD;oBACD;yBACG;wBAEK;yBACJ;sBACP;yBACM;2BACD;6BACW;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAGjC,MAAMC,SAASC,mBAAW,CAACC,eAAe,CAAC;AAEpC,eAAeH,gBAAgBI,GAA4B;IACjEH,OAAOI,IAAI,CAAC,CAAC,uBAAuB,EAAED,IAAIE,IAAI,CAACC,IAAI,CAACC,GAAG,CAAC,IAAI,CAAC;IAE7D,MAAMD,OAAO,MAAME,aAAI,CAACC,OAAO,CAAC;QAC/BF,KAAK,IAAIG,SAAMC,QAAQ,CAACR,IAAIE,IAAI,CAACC,IAAI,CAACC,GAAG,CAACK,QAAQ;IACnD;IAEA,IAAIN,QAAQ,MAAM;QACjB,OAAO,CAAC,oBAAoB,CAAC;IAC9B;IAEA,mBAAmB;IACnB,MAAM,CAACO,MAAMC,QAAQ,GAAG,MAAM,IAAIC,QAAuB,CAACC,KAAKC;QAC9DC,KAAIC,IAAI,CAAC,CAACC,GAAGP,MAAMQ,IAAIP;YACtB,IAAIM,GAAG,OAAOH,IAAIG;YAClBJ,IAAI;gBAACH;gBAAMC;aAAQ;QACpB;IACD;IAEAd,OAAOI,IAAI,CAAC,CAAC,aAAa,EAAES,KAAK,CAAC;IAElC,MAAMS,SAASC,IAAGC,iBAAiB,CAACX,MAAM;QAAEY,OAAO;IAAI;IAEvD,IAAIC,gBAAgB;IACpB,IAAIC,SAAc;IAElB,MAAMC,QAAQ,MAAMC,kBAAS,CAACC,KAAK,CAAC;QACnCC,YAAYzB,KAAKC,GAAG;IACrB;IAEA,MAAO,KAAM;QACZ,MAAMyB,aAAa,MAAMH,kBAAS,CAACI,IAAI,CAAC;YACvCF,YAAYzB,KAAKC,GAAG;WAChBoB,SAAS;YAAEpB,KAAK;gBAAE2B,KAAKP;YAAO;QAAE,IAAI,CAAC,IACvC;YACFQ,OAAO;YACPC,MAAM;gBACL7B,KAAK;YACN;QACD;QAEA,IAAIyB,WAAWK,MAAM,KAAK,GAAG;YAC5BlC,IAAImC,QAAQ,CAAC;YACb;QACD;QAEAX,SAASK,UAAU,CAACA,WAAWK,MAAM,GAAG,EAAE,CAAC9B,GAAG;QAE9C,KAAK,MAAMgC,aAAaP,WAAY;YACnC,MAAMQ,IAAI,MAAMhC,aAAI,CAACC,OAAO,CAAC;gBAAEF,KAAKgC,UAAUE,UAAU;YAAC,GAAG;gBAAEC,QAAQ;oBAAEC,UAAU;oBAAMC,MAAM;gBAAK;YAAE;YACrG,IAAIJ,KAAK,MAAM,UAAU,eAAe;YACxC,MAAMK,UAAUC,IAAAA,6BAAgB,EAACN,EAAEG,QAAQ,EAAEH,EAAEI,IAAI;YACnD,MAAM,IAAI7B,QAAQ,CAACC,KAAKC;gBACvBK,OAAOyB,KAAK,CAACF,UAAU,MAAMG,CAAAA;oBAC5B,IAAIA,KAAK;wBACRhD,OAAOiD,KAAK,CAACD;wBACb/B,IAAI+B;oBACL,OAAO;wBACNhC;oBACD;gBACD;YACD;YACAU;QACD;QAEAvB,IAAImC,QAAQ,CAACZ,gBAAgBE;IAC9B;IAEAN,OAAO4B,GAAG;IACVlD,OAAOmD,IAAI,CAAC,CAAC,aAAa,EAAEtC,KAAK,CAAC;IAElC,MAAMuC,WAAW,eAAeC,IAAAA,eAAM,EAAC,IAAIC,QAAQ,yBAAyB;IAC5E,MAAMC,YAAY,MAAMC,IAAAA,gBAAO,EAAC;QAAElD;QAAMO;QAAM4C,MAAML;QAAUM,OAAO;IAAK;IAE1E5C;IACA,OAAO,CAAC,aAAa,EAAEyC,UAAUhD,GAAG,CAAC,CAAC;AACvC","file":"export-following.js","sourceRoot":"../../../../built"}