{"version":3,"sources":["queue/processors/db/export-notes.js"],"names":["exportNotes","logger","queueLogger","createSubLogger","job","info","data","user","_id","User","findOne","mongo","ObjectID","toString","path","cleanup","Promise","res","rej","tmp","file","e","fd","stream","fs","createWriteStream","flags","write","err","error","exportedNotesCount","cursor","total","Note","count","userId","notes","find","$gt","limit","sort","length","progress","note","content","JSON","stringify","serialize","end","succ","fileName","format","Date","driveFile","addFile","name","force","id","text","createdAt","fileIds","replyId","renoteId","poll","cw","viaMobile","visibility","visibleUserIds","appId","geo","localOnly","copyOnce"],"mappings":"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","file":"export-notes.js","sourceRoot":"../../../../built"}