{"version":3,"sources":["queue/processors/inbox.js"],"names":["tryProcessInbox","logger","Logger","job","data","ctx","signature","activity","resolver","Resolver","dbResolver","DbResolver","debug","inspect","host","toUnicode","URL","keyId","hostname","toLowerCase","isBlockedHost","user","getRemoteUserFromKeyId","resolvePerson","getApId","actor","undefined","isDelete","isUndo","e","StatusError","isClientError","statusCode","publicKey","httpSignatureValidated","httpSignature","verifySignature","publicKeyPem","resolveUser","username","uri","config","ignoreApForwarded","type","creator","candicate","replace","catch","ldSignature","LdSignature","verified","verifyRsaSignature2017","ldHost","extractApHost","id","signerHost","activityIdHost","registerOrFetchInstanceDoc","then","i","set","latestRequestReceivedAt","Date","lastCommunicatedAt","isNotResponding","isMarkedAsClosed","Instance","update","_id","$set","publishInstanceModUpdated","UpdateInstanceinfo","request","instanceChart","requestReceived","perform"],"mappings":"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","file":"inbox.js","sourceRoot":"../../../built"}