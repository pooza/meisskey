{"version":3,"sources":["remote/activitypub/renderer/note.js"],"names":["renderNote","getEmojis","note","dive","inReplyTo","inReplyToNote","replyId","Note","findOne","_id","inReplyToUser","User","userId","uri","config","url","quote","renoteId","renote","user","attributedTo","mentions","mentionedRemoteUsers","length","map","x","to","cc","copyOnce","visibility","concat","mentionedUsers","find","$in","hashtagTags","tags","tag","renderHashtag","mentionTags","u","renderMention","files","Promise","all","fileIds","DriveFile","filter","text","apText","summary","cw","String","fromCharCode","content","getNoteHtml","Object","assign","emojis","apemojis","emoji","renderEmoji","choices","expiresAt","multiple","poll","asPoll","type","Date","votes","name","replies","totalItems","id","_misskey_content","_misskey_quote","quoteUri","published","createdAt","toISOString","attachment","renderDocument","sensitive","some","file","metadata","isSensitive","names","nameToEmoji","m","match","Emoji","host"],"mappings":"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","file":"note.js","sourceRoot":"../../../../built"}