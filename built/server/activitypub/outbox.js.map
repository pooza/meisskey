{"version":3,"sources":["server/activitypub/outbox.js"],"names":["packActivity","ctx","config","disableFederation","throw","ObjectID","isValid","params","user","status","userId","sinceId","sinceIdErr","$","optional","type","ID","get","request","query","since_id","untilId","untilIdErr","until_id","pageErr","str","or","ok","page","countIf","x","User","findOne","_id","isDeleted","$ne","isSuspended","noFederation","host","limit","partOf","url","sort","visibility","$in","localOnly","copyOnce","$gt","transform","$lt","notes","Note","find","reverse","activities","Promise","all","map","note","rendered","renderOrderedCollectionPage","notesCount","length","toHexString","body","renderActivity","setResponseType","renderOrderedCollection","set","renoteId","text","poll","fileIds","renote","Error","renderAnnounce","uri","renderCreate","renderNote"],"mappings":"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","file":"outbox.js","sourceRoot":"../../../built"}