{"version":3,"sources":["server/api/endpoints/notes/polls/vote.js"],"names":["meta","desc","tags","requireCredential","kind","params","noteId","validator","$","type","ID","transform","choice","num","errors","noSuchNote","message","code","id","noPoll","invalidChoice","alreadyVoted","alreadyExpired","define","ps","user","createdAt","Date","note","getNote","catch","e","ApiError","poll","expiresAt","choices","some","x","exist","Vote","find","_id","userId","length","multiple","vote","insert","inc","findIndex","c","Note","update","$inc","publishNoteStream","toHexString","createNotification","Watching","$ne","deletedAt","$exists","fields","then","watchers","watcher","settings","autoWatch","watch","oidEquals","createNotifyPollFinishedJob","_user","host","pollOwner","User","findOne","deliver","renderActivity","renderVote","inbox","deliverQuestionUpdate"],"mappings":"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","file":"vote.js","sourceRoot":"../../../../../../built"}