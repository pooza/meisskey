{"version":3,"sources":["server/api/endpoints/notes/search.js"],"names":["meta","desc","tags","requireCredential","allowGet","cacheSec","params","query","validator","$","str","limit","optional","num","range","default","offset","min","res","type","items","errors","searchingNotAvailable","message","code","id","define","ps","me","internal","searchInternal","catch","e","console","warn","ApiError","tokens","trim","split","words","from","followFrom","since","until","types","withFiles","host","sensitive","withPolls","token","matchFrom","match","user","User","findOne","usernameLower","toLowerCase","toDbHost","matchFollow","matchSince","Date","matchUntil","matchFilter","concat","watches","NoteWatching","find","userId","_id","skip","sort","packMany","map","w","noteId","matchSensitive","matchHost","isSelfHost","push","length","config","mecabSearch","visibleQuery","visibility","$in","isFollowing","Following","followerId","followeeId","visibleUserIds","myFollowingIds","getFriendIds","$and","followings","getFriends","followQuery","f","$or","hideUserIds","getHideUserIds","noteQuery","deletedAt","$nin","targetFollowingIds","$gt","mongo","ObjectID","genMeid7","$lt","fileIds","$exists","$ne","poll","ws","getIndexer","text","join","mecabWords","$all","notes","Note","maxTimeMS"],"mappings":"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","file":"search.js","sourceRoot":"../../../../../built"}