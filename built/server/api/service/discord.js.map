{"version":3,"sources":["server/api/service/discord.js"],"names":["getUserToken","ctx","headers","match","compareOrigin","normalizeUrl","url","endsWith","substr","length","referer","config","router","Router","get","throw","userToken","user","User","findOneAndUpdate","host","$set","body","publishMainStream","_id","pack","detail","includeSecrets","getOAuth2","meta","fetchMeta","enableDiscordIntegration","OAuth2","discordClientId","discordClientSecret","params","redirect_uri","scope","state","uuid","response_type","redis","set","JSON","stringify","oauth2","redirect","getAuthorizeUrl","sessid","cookies","path","secure","startsWith","httpOnly","code","query","Promise","res","rej","_","parse","accessToken","refreshToken","expiresDate","getOAuthAccessToken","grant_type","err","result","error","Date","now","Number","expires_in","id","global_name","username","discriminator","getJson","findOne","discord","signin","token"],"mappings":"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","file":"discord.js","sourceRoot":"../../../../built"}