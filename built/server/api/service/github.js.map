{"version":3,"sources":["server/api/service/github.js"],"names":["getUserToken","ctx","headers","match","compareOrigin","normalizeUrl","url","endsWith","substr","length","referer","config","router","Router","get","throw","userToken","user","User","findOneAndUpdate","host","$set","body","publishMainStream","_id","pack","detail","includeSecrets","getOath2","meta","fetchMeta","enableGithubIntegration","OAuth2","githubClientId","githubClientSecret","params","redirect_uri","scope","state","uuid","redis","set","JSON","stringify","oauth2","redirect","getAuthorizeUrl","sessid","cookies","path","secure","startsWith","httpOnly","code","query","Promise","res","rej","_","parse","accessToken","getOAuthAccessToken","err","refresh","result","error","login","id","getJson","findOne","signin","token","github","username"],"mappings":"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","file":"github.js","sourceRoot":"../../../../built"}