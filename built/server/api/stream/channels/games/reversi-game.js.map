{"version":3,"sources":["server/api/stream/channels/games/reversi-game.js"],"names":["Channel","init","params","gameId","mongo","ObjectID","subscriber","on","data","send","onMessage","type","body","accept","updateSettings","settings","initForm","updateForm","id","value","message","set","pos","check","crc32","game","ReversiGame","findOne","_id","isStarted","user1Id","equals","user","user2Id","user1Accepted","user2Accepted","update","$set","publishReversiGameStream","form","form1","form2","userId","item","find","i","Math","random","bothAccepted","user1","user2","setTimeout","freshGame","isEnded","bw","getRandomMap","mapCount","Object","entries","maps","length","rnd","floor","values","map","startedAt","Date","black","o","Reversi","isLlotheo","canPutEverywhere","loopedBoard","winner","winnerId","pack","log","logs","put","color","myColor","canPut","at","CRC32","str","x","toString","join","$push","assign","next","turn","chName","requireCredential","autobind"],"mappings":"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","file":"reversi-game.js","sourceRoot":"../../../../../../built"}