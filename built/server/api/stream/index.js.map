{"version":3,"sources":["server/api/stream/index.js"],"names":["Connection","onWsConnectionMessage","data","toString","type","body","JSON","parse","onApiRequest","onReadNotification","onSubscribeNote","onUnsubscribeNote","onChannelConnectRequested","onChannelDisconnectRequested","onChannelMessageRequested","payload","user","User","findOne","_id","endpoint","ep","call","app","then","res","sendMessageToWs","id","catch","e","error","message","code","kind","info","readNotification","subscribingNotes","subscriber","on","onNoteStreamMessage","read","readNote","off","channel","params","pong","connectChannel","disconnectChannel","sendMessageToWsOverride","wsConnection","send","stringify","channels","requireCredential","ch","push","init","find","c","dispose","filter","onMessage","onServerEvent","updateMuting","close","hides","getHideUserIdsById","muting","map","x","constructor","autobind"],"mappings":"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","file":"index.js","sourceRoot":"../../../../built"}