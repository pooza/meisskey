{"version":3,"sources":["server/index.js"],"names":["serverLogger","startServer","Logger","app","Koa","proxy","maxIpsCount","config","proxyIpHeader","includes","process","env","NODE_ENV","use","koaLogger","str","info","envOption","slow","delay","url","startsWith","disableHsts","ctx","next","set","mount","apiServer","require","router","Router","activityPub","routes","nodeinfo","wellKnown","get","user","username","host","parse","params","acct","resolveUser","catch","avatarId","getDriveFileUrl","DriveFile","findOne","_id","redirect","driveUrl","User","emailVerifyCode","code","body","status","update","$set","emailVerified","createServer","http","callback","server","listen","port","addr","undefined","Promise","resolve","on","e","error","cluster","isWorker","send","exit","socket","fs","unlinkSync","path","chmodSync","queue","requestStats","stats","ok","push","setInterval","length","requests","time","sum","map","x","incomingBytes","req","byets","outgoingBytes","res","networkChart"],"mappings":"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","file":"index.js","sourceRoot":"../../built"}