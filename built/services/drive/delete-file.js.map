{"version":3,"sources":["services/drive/delete-file.js"],"names":["file","isExpired","metadata","storage","drive","getDriveConfig","uri","storageProps","bucket","s3Client","getS3Client","obj","key","prefix","id","send","DeleteObjectCommand","Bucket","Key","thumbnailUrl","thumbnailObj","thumbnailKey","webpublicUrl","webpublicObj","webpublicKey","DriveFileChunk","remove","files_id","_id","fileSystem","InternalStorage","del","set","Date","_user","host","undefined","DriveFile","update","$set","thumbnail","DriveFileThumbnail","findOne","DriveFileThumbnailChunk","webpublic","DriveFileWebpublic","DriveFileWebpublicChunk","driveChart","isRemoteUser","instanceChart","updateDrive","Instance","$inc","driveUsage","length","driveFiles"],"mappings":"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","file":"delete-file.js","sourceRoot":"../../../built"}