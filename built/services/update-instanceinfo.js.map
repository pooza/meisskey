{"version":3,"sources":["services/update-instanceinfo.js"],"names":["logger","UpdateInstanceinfo","fetchInstanceinfo","fetchNodeinfo","Logger","instance","request","_instance","Instance","findOne","host","updateNeeded","infoUpdatedAt","now","Date","getTime","ip","isp","update","_id","$set","info","toApHost","JSON","stringify","set","softwareName","softwareVersion","openRegistrations","name","description","maintainerName","maintainerEmail","activeHalfyear","activeMonth","notesCount","usersCount","geoip","config","enableInstanceGeoIp","geoIpLookup","catch","e","warn","cc","org","as","iconUrl","manifestUrl","fetchTop","manifest","fetchManifest","theme_color","themeColor","metadata","nodeName","nodeDescription","maintainer","email","mastodon","fetchMastodonInstance","title","software","version","expectNumber","usage","users","total","localPosts","wellKnownUrl","wellKnown","getJson","links","map","v","find","link","rel","filter","x","nodeinfo","href","json","doc","url","html","getHtml","window","JSDOM","document","hrefAppleTouchIconPrecomposed","querySelector","getAttribute","hrefAppleTouchIcon","hrefIcon","URL","manifestHref"],"mappings":"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","file":"update-instanceinfo.js","sourceRoot":"../../built"}